.janggi-board {
  position: relative;
  /* Fluid sizing */
  width: 90vmin;
  max-width: 650px; 
  aspect-ratio: 500 / 550;
  height: auto;
  background-color: #e3c080;
  border: 2px solid #5a3a22;
  /* Centering */
  margin: 20px auto; 
  box-sizing: border-box;
  overflow: visible;
  /* Add shadowing for 3d effect */
  box-shadow: 5px 5px 15px rgba(0,0,0,0.5);
}

.grid-container {
  display: flex;
  flex-direction: column;
  width: 100%;
  height: 100%;
  position: absolute;
  top: 0;
  left: 0;
  /* Percentage padding to scale with board */
  padding: 8%; 
  box-sizing: border-box;
}

/* ... grid-row, grid-cell existing ... */
.grid-row {
    display: flex;
    flex: 1;
}
  
.grid-cell {
    flex: 1;
    border-right: 1px solid #000;
    border-bottom: 1px solid #000;
}

.grid-cell:last-child {
    border-right: none;
}
  
.grid-row:last-child .grid-cell {
    border-bottom: none;
}

/* Update border box to match new padding */
.grid-container::before {
  content: '';
  position: absolute;
  top: 8%;
  left: 8%;
  right: 8%;
  bottom: 8%;
  border-top: 1px solid #000;
  border-left: 1px solid #000;
  pointer-events: none;
}

/* Update palace positioning based on padding */
/* Palace size: 2 cols out of 8 cols = 25% of inner width */
/* Inner width is 100% - 16%. Palace width relative to board = 21% */
.palace {
    position: absolute;
    /* 2/8 of inner width (84%) = 21% */
    width: 21%; 
    /* 2/9 of inner height (84%) ~= 18.66% */
    height: 18.66%; 
    pointer-events: none;
}

.palace-top {
    top: 8%;
    left: 50%;
    transform: translateX(-50%);
}

.palace-bottom {
    bottom: 8%;
    left: 50%;
    transform: translateX(-50%);
}

.piece-layer {
  position: absolute;
  top: 8%; 
  left: 8%;
  right: 8%;
  bottom: 8%;
  /* Reduce size to match the GRID LINES exactly */
  /* Pieces are positioned relative to this box */
  /* Remove grid display, use absolute positioning for children */
  display: block; 
  pointer-events: none;
}

/* Generic child rule removed as specific interaction-cell rule handles it */

.interaction-cell {
  /* Base style for content */
  display: flex;
  justify-content: center;
  align-items: center;
  cursor: pointer;
}

/* Enforce values even if interaction-cell class is used */
.piece-layer .interaction-cell {
  position: absolute; /* Force absolute positioning */
  /* Responsive piece size: approx 10% of the inner grid width */
  width: 11%; 
  aspect-ratio: 1/1;
  height: auto;
  /* Center the cell on its coordinate */
  transform: translate(-50%, -50%);
  z-index: 10;
  pointer-events: auto; /* Enable clicks! */
}

.interaction-cell.selected {
  background-color: rgba(255, 255, 0, 0.3);
  border-radius: 50%;
}

.move-marker {
  width: 30%; /* Relative to cell */
  height: 30%;
  background-color: rgba(0, 255, 0, 0.6);
  border-radius: 50%;
  position: absolute;
  z-index: 20;
  pointer-events: none;
}

.interaction-cell:hover {
  cursor: pointer;
}

.piece-layer.rotated-view {
  transform: rotate(180deg);
}

.piece-layer.rotated-view .interaction-cell {
  transform: rotate(180deg); /* Counter-rotate cells so pieces stay upright? */
}
/* If useRotatedPieces is used, we might want to NOT counter-rotate those specific pieces? */
/* Actually, interaction-cell is the container. If we rotate that, the piece rotates. */
/* Just rotate the whole board container? */

.janggi-board.rotated-view .grid-container,
.janggi-board.rotated-view .piece-layer {
   transform: rotate(180deg);
}
/* Wait, if I rotate piece-layer, grid lines remain unrotated if I don't rotate grid-container. */

/* Counter-rotate pieces in rotated view so they stay upright */
.piece-layer.rotated-view .piece {
  transform: rotate(180deg);
}

/* --- Overlays & Notifications --- */

.overlay {
    position: absolute;
    top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0, 0, 0, 0.85);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    color: white;
    font-size: 2em;
    z-index: 100;
    border-radius: 4px;
}

.winner-overlay > div {
    margin-bottom: 20px;
}

.check-alert {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  color: red;
  font-size: 3em;
  font-weight: bold;
  text-shadow: 2px 2px 5px black;
  z-index: 90;
  pointer-events: none;
  animation: flash 2s infinite;
}

@keyframes flash {
  0% { opacity: 1; }
  50% { opacity: 0; }
  100% { opacity: 1; }
}

/* --- Score Board --- */

.score-board {
  display: flex;
  gap: 40px;
  background: rgba(0,0,0,0.3);
  padding: 10px 30px;
  border-radius: 8px;
  font-size: 1.2em;
  font-weight: bold;
  margin-top: 10px;
  justify-content: center;
}

.score-item.cho { color: #5078f2; }
.score-item.han { color: #f25050; }

/* --- Setup UI --- */

.setup-overlay {
    background: rgba(40, 44, 52, 0.95);
    z-index: 200;
}

/* 2x2 Grid Layout for Setup Options */
.setup-options {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
    margin-top: 20px;
    width: 100%;
    max-width: 400px;
}

.setup-btn {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 15px;
    border: 2px solid #555;
    background: #333;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s;
    width: 100%; /* Fill grid cell */
    box-sizing: border-box;
    color: #eee;
}

.setup-btn:hover {
    background: #444;
    border-color: #888;
    transform: translateY(-2px);
}

.setup-label {
    margin-bottom: 10px;
    font-size: 1rem;
    font-weight: bold;
}

.setup-preview {
    display: flex;
    flex-direction: row; /* Horizontal alignment */
    gap: 4px;
    background: rgba(255, 255, 255, 0.1);
    padding: 5px;
    border-radius: 4px;
}

/* Restrict Piece Size for Setup */
.setup-piece {
    width: 30px; 
    height: 30px;
    display: flex;
    justify-content: center;
    align-items: center;
}

/* Ensure inner piece image fits */

/* --- Responsive Layout --- */


.janggi-game-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 20px;
}

.janggi-sidebar {
    display: flex;
    flex-direction: column;
    gap: 20px;
    width: 100%;
    /* Remove strict max-width to allow growth optionally, or keep it but larger */
    max-width: 500px; /* Keep reasonable limit on mobile */
    /* Center items horizontally within the sidebar */
    align-items: center; 
}

.settings-controls {
    background: rgba(0,0,0,0.2);
    padding: 15px;
    border-radius: 8px;
    display: flex;
    flex-direction: column;
    gap: 15px;
    /* Ensure the settings box itself is centered if it doesn't take full width */
    width: 100%; 
    box-sizing: border-box;
    align-items: center; 
}

.control-row {
    display: flex;
    gap: 20px;
    justify-content: center;
    align-items: center;
    flex-wrap: wrap;
}

/* Wide screen: Board Left, Sidebar Right */
@media (min-width: 950px) {
    .janggi-game-container {
        flex-direction: row;
        align-items: center; /* Vertically align sidebar to center relative to board */
        justify-content: center;
        gap: 40px; /* Increase gap for wider screens */
        padding: 20px;
        box-sizing: border-box;
    }
    
    .janggi-sidebar {
        /* Sidebar takes remaining space but not too much */
        width: 350px; 
        flex-shrink: 0;
        max-width: none;
    }
    
    .janggi-board {
        /* Allow board to take more focus */
        width: 60vmin; 
        max-width: 800px;
    }
}
